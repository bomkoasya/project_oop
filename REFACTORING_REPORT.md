
# Звіт про виконання рефакторингу проєкту MyFinanceApp

## 1. Вступ

Метою даного етапу розробки було покращення архітектури коду, підвищення чуйності графічного інтерфейсу користувача (GUI) та усунення технічного боргу. Основний фокус був зосереджений на розділенні бізнес-логіки та UI, а також на впровадженні багатопотоковості для довготривалих операцій (I/O).

## 2. Цілі рефакторингу

* **Non-blocking UI (Неблокуючий інтерфейс):** Запобігання "зависанню" головного вікна програми під час мережевих запитів або роботи з файловою системою.
* **Single Responsibility Principle (Принцип єдиної відповідальності):** Очищення класу `Logic` від коду, що не стосується його прямого призначення (роботи зі станом).
* **Потокобезпека (Thread Safety):** Безпечне оновлення елементів інтерфейсу Qt з фонових потоків.

## 3. Виконані завдання

### 3.1. Впровадження асинхронності для мережевих запитів (`CurrencyConverter`)

* **Проблема:** Синхронний запит до API курсів валют через бібліотеку `cpr` блокував головний потік Qt.
* **Рішення:** Створено метод `fetchRatesFromAPIAsync`, який використовує `std::thread` для виконання HTTP-запиту у фоновому потоці.
* **Реалізація:** Результат запиту повертається через функцію зворотного виклику `std::function<void(bool)> callback`, що дозволяє ядру залишатися незалежним від фреймворку Qt.

### 3.2. Асинхронне збереження та завантаження даних (`Logic`)

* **Проблема:** Читання та запис об'ємних JSON-файлів (профілю користувача з історією транзакцій) у головному потоці могло викликати затримки під час запуску або закриття програми.
* **Рішення:** Додано дві нові функції:
* `loadUserDataAsync` — завантажує дані у фоні, приймаючи посилання на об'єкти `User` та `Database`.
* `saveUserDataAsync` — зберігає дані у фоні. Для забезпечення потокобезпеки об'єкт `User` передається **по значенню** (створюється копія), що унеможливлює виникнення Data Race, якщо користувач продовжить взаємодію з програмою під час збереження.



### 3.3. Видалення технічного боргу (Очищення CLI-коду)

* **Проблема:** У файлах `Logic.h` та `Logic.cpp` залишалися застарілі функції для консольного вводу/виводу (`addTransaction`, `showTransactions`, `handleReports` тощо), які використовували `std::cin` та `std::cout`, що є неприпустимим для GUI-додатку.
* **Рішення:** * Застарілі функції та їх оголошення були повністю видалені.
* Вилучено непотрібні бібліотеки (`<iomanip>`, `<limits>`).
* Клас `Logic` тепер відповідає виключно за серіалізацію/десеріалізацію стану програми.



### 3.4. Інтеграція асинхронності в GUI (`MainWindow`)

* **Проблема:** Головне вікно використовувало старі синхронні методи та мало функції-заглушки.
* **Рішення:**
* Видалено локальні функції-заглушки `loadUserData` та `saveUserData` з `MainWindow`.
* Під час старту програми (у конструкторі) інтерфейс переводиться в режим очікування (кнопки блокуються через `setEnabled(false)`), і викликається `loadUserDataAsync`.
* Після завершення фонового завантаження інтерфейс розблоковується.
* Для безпечного оновлення UI з фонового потоку використано механізм подій Qt: `QMetaObject::invokeMethod`.
* Аналогічно оновлено процес виходу з програми: вікно закривається лише після успішного завершення `saveUserDataAsync`.



## 4. Використані технології та інструменти

* **C++11/C++17:** `std::thread`, `std::function`, лямбда-вирази.
* **Qt Framework:** `QMetaObject::invokeMethod` для міжпотокової комунікації.
* **Git:** Створення окремої гілки `refactoring` для ізольованої розробки та тестування змін.

## 5. Висновок

Проведений рефакторинг значно покращив архітектуру програми. Відділення важких операцій введення/виведення у фонові потоки зробило додаток MyFinanceApp професійнішим та комфортнішим для кінцевого користувача. Структура коду стала чистішою, що полегшить подальше масштабування (наприклад, перехід на патерн Model/View для таблиць або впровадження нових фінансових стратегій).